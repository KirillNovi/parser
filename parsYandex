package org.example;

import org.openqa.selenium.By;
import org.openqa.selenium.Keys;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;

import java.awt.*;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.NoSuchElementException;

public class Main {
    public static void main(String[] args) throws AWTException, IOException, InterruptedException {
        List<String> https = new ArrayList<>();
        Robot myrobot = new Robot();
        FileWriter site = new FileWriter("karting.txt");


        WebDriver driver = new ChromeDriver();
        driver.get("https://yandex.com/maps/213/moscow");
        WebElement element2 = driver.findElement(By.className("search-form-view__input"));
        element2.click();
        WebElement element1 = element2.findElement(By.xpath("//input[@class='input__control _bold']"));
        element1.sendKeys("Картинг москва", Keys.ENTER);


        Thread.sleep(1500);
        myrobot.mouseWheel(105000);
        Thread.sleep(5000);
        //myrobot.mouseWheel(80000);
        //Thread.sleep(10000);


        List<WebElement> elements = driver.findElements(By.cssSelector("li.search-snippet-view"));
        String rating = "";
        for (WebElement element : elements) {

            if (hasRating(element)){
                rating = element.findElement(By.cssSelector("div.search-business-snippet-view__rating-and-awards")).getText();
                if (!rating.isEmpty()) {
                    rating = rating.replaceAll("[^0-9,]", "");
                    rating = rating.replace(",", ".");
                    double rtg = Double.parseDouble(rating);
                    if (rtg >= 4.8) {
                        String href = element.findElement(By.cssSelector("a")).getAttribute("href");
                        https.add(href);
                        site.write(href + "\n");
                        System.out.print("|");
                        Thread.sleep(1000);
                    }
                }
            }
        }
        Thread.sleep(10000);
        site.close();
        System.out.println("END");
        Thread.sleep(5000);
        driver.quit();




    }
    public static boolean hasRating (WebElement element){
        boolean hasRating;
        try {
            element.findElement(By.cssSelector("div.search-business-snippet-view__rating-and-awards"));
            hasRating = true;
        }catch (NoSuchElementException ex){
            hasRating = false;
        }
        return hasRating;
    }
}
